<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: SPARQL::Algebra::Operator::Group
  
    &mdash; SPARQL - SPARQL for RDF.rb
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "SPARQL::Algebra::Operator::Group";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (G)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../SPARQL.html" title="SPARQL (module)">SPARQL</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Algebra.html" title="SPARQL::Algebra (module)">Algebra</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">Operator</a></span></span>
     &raquo; 
    <span class="title">Group</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: SPARQL::Algebra::Operator::Group
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">SPARQL::Algebra::Operator</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next"><span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">SPARQL::Algebra::Operator</a></span></li>
          
            <li class="next">SPARQL::Algebra::Operator::Group</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="../Query.html" title="SPARQL::Algebra::Query (module)">Query</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/sparql/algebra/operator/group.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>The SPARQL <code>group</code> operator.</p>

<p><code>group</code> takes either two or three operands. The first operand is an array of grouped variables. The last operand is the query to be grouped. If three operands are provided, the second is an array of temporary bindings.</p>

<p>[19] GroupClause ::= ‘GROUP’ ‘BY’ GroupCondition+</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>SPARQL Grammar</p>
</div></p>
      
      <pre class="example code"><code>PREFIX : &lt;http://www.example.org&gt;

SELECT ?P (COUNT(?O) AS ?C)
WHERE { ?S ?P ?O }
GROUP BY ?P</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>SSE</p>
</div></p>
      
      <pre class="example code"><code>(prefix
 ((: &lt;http://www.example.org&gt;))
 (project (?P ?C)
  (extend ((?C ??.0))
   (group (?P) ((??.0 (count ?O)))
    (bgp (triple ?S ?P ?O))))))</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>SPARQL Grammar (HAVING aggregate)</p>
</div></p>
      
      <pre class="example code"><code>PREFIX : &lt;http://www.example.org/&gt;
SELECT ?s (AVG(?o) AS ?avg)
WHERE { ?s ?p ?o }
GROUP BY ?s
HAVING (AVG(?o) &lt;= 2.0)</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>SSE (HAVING aggregate)</p>
</div></p>
      
      <pre class="example code"><code>(prefix ((: &lt;http://www.example.org/&gt;))
 (project (?s ?avg)
  (filter (&lt;= ??.0 2.0)
   (extend ((?avg ??.0))
    (group (?s) ((??.0 (avg ?o)))
     (bgp (triple ?s ?p ?o)))))) )</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>SPARQL Grammar (non-trivial filters)</p>
</div></p>
      
      <pre class="example code"><code>PREFIX : &lt;http://example.com/data/#&gt;
SELECT ?g (AVG(?p) AS ?avg) ((MIN(?p) + MAX(?p)) / 2 AS ?c)
WHERE { ?g :p ?p . }
GROUP BY ?g</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>SSE (non-trivial filters)</p>
</div></p>
      
      <pre class="example code"><code>(prefix ((: &lt;http://example.com/data/#&gt;))
 (project (?g ?avg ?c)
  (extend ((?avg ??.0) (?c (/ (+ ??.1 ??.2) 2)))
   (group (?g)
          ((??.0 (avg ?p))
           (??.1 (min ?p))
           (??.2 (max ?p)))
    (bgp (triple ?g :p ?p)))) ))</code></pre>
    
  </div>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://www.w3.org/TR/sparql11-query/#sparqlAlgebra" target="_parent" title="https://www.w3.org/TR/sparql11-query/#sparqlAlgebra">https://www.w3.org/TR/sparql11-query/#sparqlAlgebra</a></li>
    
  </ul>

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="NAME-constant" class="">NAME =
          
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span><span class='symbol'>:group</span><span class='rbracket'>]</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants inherited
     from <span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">SPARQL::Algebra::Operator</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Operator.html#ARITY-constant" title="SPARQL::Algebra::Operator::ARITY (constant)">ARITY</a></span>, <span class='object_link'><a href="../Operator.html#IsURI-constant" title="SPARQL::Algebra::Operator::IsURI (constant)">IsURI</a></span>, <span class='object_link'><a href="../Operator.html#URI-constant" title="SPARQL::Algebra::Operator::URI (constant)">URI</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../Expression.html" title="SPARQL::Algebra::Expression (module)">Expression</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Expression.html#PATTERN_PARENTS-constant" title="SPARQL::Algebra::Expression::PATTERN_PARENTS (constant)">Expression::PATTERN_PARENTS</a></span></p>




  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes included from <span class='object_link'><a href="../Query.html" title="SPARQL::Algebra::Query (module)">Query</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Query.html#solutions-instance_method" title="SPARQL::Algebra::Query#solutions (method)">#solutions</a></span></p>

  
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">SPARQL::Algebra::Operator</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Operator.html#operands-instance_method" title="SPARQL::Algebra::Operator#operands (method)">#operands</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute-instance_method" title="#execute (instance method)">#<strong>execute</strong>(queryable, **options) {|solution| ... } &#x21d2; RDF::Query::Solutions </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Executes <code>query</code> with <code>queryable</code> and groups results based on the first operand.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#internal_variables-instance_method" title="#internal_variables (instance method)">#<strong>internal_variables</strong>  &#x21d2; Hash{Symbol =&gt; RDF::Query::Variable} </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The variables used within the query.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_sparql-instance_method" title="#to_sparql (instance method)">#<strong>to_sparql</strong>(extensions: {}, filter_ops: [], **options)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a partial SPARQL grammar for this operator.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate!-instance_method" title="#validate! (instance method)">#<strong>validate!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>It is an error for aggregates to project variables with a name already used in other aggregate projections, or in the WHERE clause.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#variables-instance_method" title="#variables (instance method)">#<strong>variables</strong>  &#x21d2; Hash{Symbol =&gt; RDF::Query::Variable} </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The variables used in the extension.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Query.html" title="SPARQL::Algebra::Query (module)">Query</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Query.html#each_solution-instance_method" title="SPARQL::Algebra::Query#each_solution (method)">#each_solution</a></span>, <span class='object_link'><a href="../Query.html#empty%3F-instance_method" title="SPARQL::Algebra::Query#empty? (method)">#empty?</a></span>, <span class='object_link'><a href="../Query.html#failed%3F-instance_method" title="SPARQL::Algebra::Query#failed? (method)">#failed?</a></span>, <span class='object_link'><a href="../Query.html#graph_name=-instance_method" title="SPARQL::Algebra::Query#graph_name= (method)">#graph_name=</a></span>, <span class='object_link'><a href="../Query.html#matched%3F-instance_method" title="SPARQL::Algebra::Query#matched? (method)">#matched?</a></span>, <span class='object_link'><a href="../Query.html#query_yields_boolean%3F-instance_method" title="SPARQL::Algebra::Query#query_yields_boolean? (method)">#query_yields_boolean?</a></span>, <span class='object_link'><a href="../Query.html#query_yields_solutions%3F-instance_method" title="SPARQL::Algebra::Query#query_yields_solutions? (method)">#query_yields_solutions?</a></span>, <span class='object_link'><a href="../Query.html#query_yields_statements%3F-instance_method" title="SPARQL::Algebra::Query#query_yields_statements? (method)">#query_yields_statements?</a></span>, <span class='object_link'><a href="../Query.html#unshift-instance_method" title="SPARQL::Algebra::Query#unshift (method)">#unshift</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">SPARQL::Algebra::Operator</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Operator.html#aggregate%3F-instance_method" title="SPARQL::Algebra::Operator#aggregate? (method)">#aggregate?</a></span>, <span class='object_link'><a href="../Operator.html#arity-class_method" title="SPARQL::Algebra::Operator.arity (method)">arity</a></span>, <span class='object_link'><a href="../Operator.html#base_uri-instance_method" title="SPARQL::Algebra::Operator#base_uri (method)">#base_uri</a></span>, <span class='object_link'><a href="../Operator.html#base_uri-class_method" title="SPARQL::Algebra::Operator.base_uri (method)">base_uri</a></span>, <span class='object_link'><a href="../Operator.html#base_uri=-class_method" title="SPARQL::Algebra::Operator.base_uri= (method)">base_uri=</a></span>, <span class='object_link'><a href="../Operator.html#bind-instance_method" title="SPARQL::Algebra::Operator#bind (method)">#bind</a></span>, <span class='object_link'><a href="../Operator.html#boolean-instance_method" title="SPARQL::Algebra::Operator#boolean (method)">#boolean</a></span>, <span class='object_link'><a href="../Operator.html#constant%3F-instance_method" title="SPARQL::Algebra::Operator#constant? (method)">#constant?</a></span>, <span class='object_link'><a href="../Operator.html#deep_dup-instance_method" title="SPARQL::Algebra::Operator#deep_dup (method)">#deep_dup</a></span>, <span class='object_link'><a href="../Operator.html#each_descendant-instance_method" title="SPARQL::Algebra::Operator#each_descendant (method)">#each_descendant</a></span>, <span class='object_link'><a href="../Operator.html#eql%3F-instance_method" title="SPARQL::Algebra::Operator#eql? (method)">#eql?</a></span>, <span class='object_link'><a href="../Operator.html#evaluatable%3F-instance_method" title="SPARQL::Algebra::Operator#evaluatable? (method)">#evaluatable?</a></span>, <span class='object_link'><a href="../Operator.html#evaluate-class_method" title="SPARQL::Algebra::Operator.evaluate (method)">evaluate</a></span>, <span class='object_link'><a href="../Operator.html#executable%3F-instance_method" title="SPARQL::Algebra::Operator#executable? (method)">#executable?</a></span>, <span class='object_link'><a href="../Operator.html#first_ancestor-instance_method" title="SPARQL::Algebra::Operator#first_ancestor (method)">#first_ancestor</a></span>, <span class='object_link'><a href="../Operator.html#for-class_method" title="SPARQL::Algebra::Operator.for (method)">for</a></span>, <span class='object_link'><a href="../Operator.html#initialize-instance_method" title="SPARQL::Algebra::Operator#initialize (method)">#initialize</a></span>, <span class='object_link'><a href="../Operator.html#inspect-instance_method" title="SPARQL::Algebra::Operator#inspect (method)">#inspect</a></span>, <span class='object_link'><a href="../Operator.html#ndvars-instance_method" title="SPARQL::Algebra::Operator#ndvars (method)">#ndvars</a></span>, <span class='object_link'><a href="../Operator.html#node%3F-instance_method" title="SPARQL::Algebra::Operator#node? (method)">#node?</a></span>, <span class='object_link'><a href="../Operator.html#operand-instance_method" title="SPARQL::Algebra::Operator#operand (method)">#operand</a></span>, <span class='object_link'><a href="../Operator.html#optimize-instance_method" title="SPARQL::Algebra::Operator#optimize (method)">#optimize</a></span>, <span class='object_link'><a href="../Operator.html#optimize!-instance_method" title="SPARQL::Algebra::Operator#optimize! (method)">#optimize!</a></span>, <span class='object_link'><a href="../Operator.html#parent-instance_method" title="SPARQL::Algebra::Operator#parent (method)">#parent</a></span>, <span class='object_link'><a href="../Operator.html#parent=-instance_method" title="SPARQL::Algebra::Operator#parent= (method)">#parent=</a></span>, <span class='object_link'><a href="../Operator.html#prefixes-instance_method" title="SPARQL::Algebra::Operator#prefixes (method)">#prefixes</a></span>, <span class='object_link'><a href="../Operator.html#prefixes-class_method" title="SPARQL::Algebra::Operator.prefixes (method)">prefixes</a></span>, <span class='object_link'><a href="../Operator.html#prefixes=-class_method" title="SPARQL::Algebra::Operator.prefixes= (method)">prefixes=</a></span>, <span class='object_link'><a href="../Operator.html#rewrite-instance_method" title="SPARQL::Algebra::Operator#rewrite (method)">#rewrite</a></span>, <span class='object_link'><a href="../Operator.html#to_binary-instance_method" title="SPARQL::Algebra::Operator#to_binary (method)">#to_binary</a></span>, <span class='object_link'><a href="../Operator.html#to_sparql-class_method" title="SPARQL::Algebra::Operator.to_sparql (method)">to_sparql</a></span>, <span class='object_link'><a href="../Operator.html#to_sxp-instance_method" title="SPARQL::Algebra::Operator#to_sxp (method)">#to_sxp</a></span>, <span class='object_link'><a href="../Operator.html#to_sxp_bin-instance_method" title="SPARQL::Algebra::Operator#to_sxp_bin (method)">#to_sxp_bin</a></span>, <span class='object_link'><a href="../Operator.html#variable%3F-instance_method" title="SPARQL::Algebra::Operator#variable? (method)">#variable?</a></span>, <span class='object_link'><a href="../Operator.html#vars-instance_method" title="SPARQL::Algebra::Operator#vars (method)">#vars</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Expression.html" title="SPARQL::Algebra::Expression (module)">Expression</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Expression.html#cast-class_method" title="SPARQL::Algebra::Expression.cast (method)">cast</a></span>, <span class='object_link'><a href="../Expression.html#constant%3F-instance_method" title="SPARQL::Algebra::Expression#constant? (method)">#constant?</a></span>, <span class='object_link'><a href="../Expression.html#evaluate-instance_method" title="SPARQL::Algebra::Expression#evaluate (method)">#evaluate</a></span>, <span class='object_link'><a href="../Expression.html#extension-class_method" title="SPARQL::Algebra::Expression.extension (method)">extension</a></span>, <span class='object_link'><a href="../Expression.html#extension%3F-class_method" title="SPARQL::Algebra::Expression.extension? (method)">extension?</a></span>, <span class='object_link'><a href="../Expression.html#extensions-class_method" title="SPARQL::Algebra::Expression.extensions (method)">extensions</a></span>, <span class='object_link'><a href="../Expression.html#for-class_method" title="SPARQL::Algebra::Expression.for (method)">for</a></span>, <span class='object_link'><a href="../Expression.html#invalid%3F-instance_method" title="SPARQL::Algebra::Expression#invalid? (method)">#invalid?</a></span>, <span class='object_link'><a href="../Expression.html#new-class_method" title="SPARQL::Algebra::Expression.new (method)">new</a></span>, <span class='object_link'><a href="../Expression.html#node%3F-instance_method" title="SPARQL::Algebra::Expression#node? (method)">#node?</a></span>, <span class='object_link'><a href="../Expression.html#open-class_method" title="SPARQL::Algebra::Expression.open (method)">open</a></span>, <span class='object_link'><a href="../Expression.html#optimize-instance_method" title="SPARQL::Algebra::Expression#optimize (method)">#optimize</a></span>, <span class='object_link'><a href="../Expression.html#optimize!-instance_method" title="SPARQL::Algebra::Expression#optimize! (method)">#optimize!</a></span>, <span class='object_link'><a href="../Expression.html#parse-class_method" title="SPARQL::Algebra::Expression.parse (method)">parse</a></span>, <span class='object_link'><a href="../Expression.html#register_extension-class_method" title="SPARQL::Algebra::Expression.register_extension (method)">register_extension</a></span>, <span class='object_link'><a href="../Expression.html#to_sxp_bin-instance_method" title="SPARQL::Algebra::Expression#to_sxp_bin (method)">#to_sxp_bin</a></span>, <span class='object_link'><a href="../Expression.html#valid%3F-instance_method" title="SPARQL::Algebra::Expression#valid? (method)">#valid?</a></span>, <span class='object_link'><a href="../Expression.html#variable%3F-instance_method" title="SPARQL::Algebra::Expression#variable? (method)">#variable?</a></span></p>

  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <p class="notice">This class inherits a constructor from <span class='object_link'><a href="../Operator.html#initialize-instance_method" title="SPARQL::Algebra::Operator#initialize (method)">SPARQL::Algebra::Operator</a></span></p>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="execute-instance_method">
  
    #<strong>execute</strong>(queryable, **options) {|solution| ... } &#x21d2; <tt><span class='object_link'><a href="../../../RDF/Query/Solutions.html" title="RDF::Query::Solutions (class)">RDF::Query::Solutions</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Executes <code>query</code> with <code>queryable</code> and groups results based on the first operand.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>queryable</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../RDF/Queryable.html" title="RDF::Queryable (module)">RDF::Queryable</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the graph or repository to query</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Hash.html" title="Hash (class)">Hash</a></span>{Symbol =&gt; <span class='object_link'><a href="Object.html" title="SPARQL::Algebra::Operator::Object (class)">Object</a></span>}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>any additional keyword options</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>solution</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>each matching solution</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>solution</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../RDF/Query/Solution.html" title="RDF::Query::Solution (class)">RDF::Query::Solution</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>void</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ignored</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../RDF/Query/Solutions.html" title="RDF::Query::Solutions (class)">RDF::Query::Solutions</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the resulting solution sequence</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://www.w3.org/TR/sparql11-query/#sparqlGroupAggregate" target="_parent" title="https://www.w3.org/TR/sparql11-query/#sparqlGroupAggregate">https://www.w3.org/TR/sparql11-query/#sparqlGroupAggregate</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sparql/algebra/operator/group.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_queryable'>queryable</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Group</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_exprlist'>exprlist</span> <span class='op'>=</span> <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
  <span class='id identifier rubyid_aggregates'>aggregates</span> <span class='op'>=</span> <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>3</span> <span class='op'>?</span> <span class='id identifier rubyid_operand'>operand</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_solutions'>solutions</span> <span class='op'>=</span> <span class='id identifier rubyid_queryable'>queryable</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='label'>depth:</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:depth</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_groups'>groups</span> <span class='op'>=</span> <span class='id identifier rubyid_solutions'>solutions</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_solution'>solution</span><span class='op'>|</span>
    <span class='comment'># Evaluate each exprlist operand to get groups where each key is a new solution
</span>    <span class='comment'># ListEval((expr1, ..., exprn), μ) returns a list (e1, ..., en), where ei = expri(μ) or error.
</span>    <span class='id identifier rubyid_soln'>soln</span> <span class='op'>=</span> <span class='const'>RDF</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>Solution</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_exprlist'>exprlist</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_operand'>operand</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_operand'>operand</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span></span><span class='rparen'>)</span>
          <span class='comment'># Form is [variable, expression]
</span>          <span class='id identifier rubyid_soln'>soln</span><span class='lbracket'>[</span><span class='id identifier rubyid_operand'>operand</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_operand'>operand</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_evaluate'>evaluate</span><span class='lparen'>(</span><span class='id identifier rubyid_solution'>solution</span><span class='comma'>,</span>
                                                      <span class='label'>queryable:</span> <span class='id identifier rubyid_queryable'>queryable</span><span class='comma'>,</span>
                                                      <span class='label'>depth:</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:depth</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span>
                                                      <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='comment'># Form is variable
</span>          <span class='id identifier rubyid_soln'>soln</span><span class='lbracket'>[</span><span class='id identifier rubyid_operand'>operand</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_operand'>operand</span><span class='period'>.</span><span class='id identifier rubyid_evaluate'>evaluate</span><span class='lparen'>(</span><span class='id identifier rubyid_solution'>solution</span><span class='comma'>,</span> <span class='label'>queryable:</span> <span class='id identifier rubyid_queryable'>queryable</span><span class='comma'>,</span>
                                                     <span class='label'>depth:</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:depth</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span>
                                                     <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>TypeError</span>
        <span class='comment'># Ignore expression
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_soln'>soln</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=&gt;(groups) </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_groups'>groups</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>

  <span class='comment'># Aggregate solutions in each group using aggregates to get solutions
</span>  <span class='ivar'>@solutions</span> <span class='op'>=</span> <span class='const'>RDF</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>Solutions</span><span class='lparen'>(</span><span class='id identifier rubyid_groups'>groups</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_group_soln'>group_soln</span><span class='comma'>,</span> <span class='id identifier rubyid_solns'>solns</span><span class='op'>|</span>
    <span class='id identifier rubyid_aggregates'>aggregates</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_var'>var</span><span class='comma'>,</span> <span class='id identifier rubyid_aggregate'>aggregate</span><span class='rparen'>)</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_group_soln'>group_soln</span><span class='lbracket'>[</span><span class='id identifier rubyid_var'>var</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_aggregate'>aggregate</span><span class='period'>.</span><span class='id identifier rubyid_aggregate'>aggregate</span><span class='lparen'>(</span><span class='id identifier rubyid_solns'>solns</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>TypeError</span>
        <span class='comment'># Ignored in output
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_group_soln'>group_soln</span>
  <span class='kw'>end</span><span class='rparen'>)</span>

  <span class='comment'># If there exprlist is empty, make sure that&#39;s at least an empty solution
</span>  <span class='kw'>if</span> <span class='ivar'>@solutions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_exprlist'>exprlist</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_soln'>soln</span> <span class='op'>=</span> <span class='const'>RDF</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>Solution</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_aggregates'>aggregates</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_var'>var</span><span class='comma'>,</span> <span class='id identifier rubyid_aggregate'>aggregate</span><span class='rparen'>)</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_soln'>soln</span><span class='lbracket'>[</span><span class='id identifier rubyid_var'>var</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_aggregate'>aggregate</span><span class='period'>.</span><span class='id identifier rubyid_aggregate'>aggregate</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>TypeError</span>
        <span class='comment'># Ignored in output
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@solutions</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_soln'>soln</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=&gt;(solutions) </span><span class='embexpr_beg'>#{</span><span class='ivar'>@solutions</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
  <span class='ivar'>@solutions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='ivar'>@solutions</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="internal_variables-instance_method">
  
    #<strong>internal_variables</strong>  &#x21d2; <tt><span class='object_link'><a href="../../../Hash.html" title="Hash (class)">Hash</a></span>{Symbol =&gt; <span class='object_link'><a href="../../../RDF/Query/Variable.html" title="RDF::Query::Variable (class)">RDF::Query::Variable</a></span>}</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The variables used within the query</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Hash.html" title="Hash (class)">Hash</a></span>{Symbol =&gt; <span class='object_link'><a href="../../../RDF/Query/Variable.html" title="RDF::Query::Variable (class)">RDF::Query::Variable</a></span>}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


189
190
191</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sparql/algebra/operator/group.rb', line 189</span>

<span class='kw'>def</span> <span class='id identifier rubyid_internal_variables'>internal_variables</span>
  <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_variables'>variables</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_sparql-instance_method">
  
    #<strong>to_sparql</strong>(extensions: {}, filter_ops: [], **options)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a partial SPARQL grammar for this operator.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>extensions</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Hash.html" title="Hash (class)">Hash</a></span>{String =&gt; <span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">Operator</a></span>}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Variable bindings</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>filter_ops</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">Operator</a></span>&gt;</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[]</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>([]) Filter Operations</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sparql/algebra/operator/group.rb', line 202</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_sparql'>to_sparql</span><span class='lparen'>(</span><span class='label'>extensions:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>filter_ops:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_having_ops'>having_ops</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>2</span>
    <span class='id identifier rubyid_temp_bindings'>temp_bindings</span> <span class='op'>=</span> <span class='id identifier rubyid_operands'>operands</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_memo'>memo</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_var'>var</span><span class='comma'>,</span> <span class='id identifier rubyid_op'>op</span><span class='rparen'>)</span><span class='op'>|</span> <span class='id identifier rubyid_memo'>memo</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_var'>var</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_op'>op</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='comment'># Replace extensions from temporary bindings
</span>    <span class='id identifier rubyid_temp_bindings'>temp_bindings</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_var'>var</span><span class='comma'>,</span> <span class='id identifier rubyid_op'>op</span><span class='op'>|</span>
      <span class='comment'># Update extensions using a temporarily bound variable with its binding
</span>      <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='id identifier rubyid_extensions'>extensions</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_memo'>memo</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_ext_var'>ext_var</span><span class='comma'>,</span> <span class='id identifier rubyid_ext_op'>ext_op</span><span class='rparen'>)</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_ext_op'>ext_op</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Operator.html" title="SPARQL::Algebra::Operator (class)">Operator</a></span></span><span class='rparen'>)</span>
          <span class='comment'># Try to recursivley replace variable within operator
</span>          <span class='id identifier rubyid_new_op'>new_op</span> <span class='op'>=</span> <span class='id identifier rubyid_ext_op'>ext_op</span><span class='period'>.</span><span class='id identifier rubyid_deep_dup'>deep_dup</span><span class='period'>.</span><span class='id identifier rubyid_rewrite'>rewrite</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_operand'>operand</span><span class='op'>|</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_operand'>operand</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Algebra.html#Variable-constant" title="SPARQL::Algebra::Variable (constant)">Variable</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_operand'>operand</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='op'>==</span> <span class='id identifier rubyid_var'>var</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
              <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
            <span class='kw'>else</span>
              <span class='id identifier rubyid_operand'>operand</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
          <span class='id identifier rubyid_memo'>memo</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_ext_var'>ext_var</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_new_op'>new_op</span><span class='rparen'>)</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_ext_op'>ext_op</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../Algebra.html#Variable-constant" title="SPARQL::Algebra::Variable (constant)">Variable</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_ext_op'>ext_op</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='op'>==</span> <span class='id identifier rubyid_var'>var</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
          <span class='id identifier rubyid_memo'>memo</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_ext_var'>ext_var</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_op'>op</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='comment'># Doesn&#39;t match this variable, so don&#39;t change
</span>          <span class='id identifier rubyid_memo'>memo</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_ext_var'>ext_var</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ext_op'>ext_op</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='comment'># Filter ops using temporary bindinds are used for HAVING clauses
</span>      <span class='id identifier rubyid_filter_ops'>filter_ops</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fop'>fop</span><span class='op'>|</span>
        <span class='id identifier rubyid_having_ops'>having_ops</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_fop'>fop</span> <span class='kw'>if</span> <span class='id identifier rubyid_fop'>fop</span><span class='period'>.</span><span class='id identifier rubyid_descendants'>descendants</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_var'>var</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_having_ops'>having_ops</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_fop'>fop</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># If used in a HAVING clause, it&#39;s not also a filter
</span>    <span class='id identifier rubyid_filter_ops'>filter_ops</span> <span class='op'>-=</span> <span class='id identifier rubyid_having_ops'>having_ops</span>

    <span class='comment'># Replace each operand in having using var with it&#39;s corresponding operation
</span>    <span class='id identifier rubyid_having_ops'>having_ops</span> <span class='op'>=</span> <span class='id identifier rubyid_having_ops'>having_ops</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_op'>op</span><span class='op'>|</span>
      <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_rewrite'>rewrite</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_operand'>operand</span><span class='op'>|</span>
        <span class='comment'># Rewrite based on temporary bindings
</span>        <span class='id identifier rubyid_temp_bindings'>temp_bindings</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='id identifier rubyid_operand'>operand</span><span class='comma'>,</span> <span class='id identifier rubyid_operand'>operand</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_to_sparql'>to_sparql</span><span class='lparen'>(</span><span class='label'>extensions:</span> <span class='id identifier rubyid_extensions'>extensions</span><span class='comma'>,</span>
                          <span class='label'>group_ops:</span> <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span>
                          <span class='label'>having_ops:</span> <span class='id identifier rubyid_having_ops'>having_ops</span><span class='comma'>,</span>
                          <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate!-instance_method">
  
    #<strong>validate!</strong>  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="SPARQL::Algebra::Operator::Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>It is an error for aggregates to project variables with a name already used in other aggregate projections, or in the WHERE clause.</p>

<p>It is also an error to project ungrouped variables</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sparql/algebra/operator/group.rb', line 147</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate!'>validate!</span>
  <span class='id identifier rubyid_group_vars'>group_vars</span> <span class='op'>=</span> <span class='id identifier rubyid_operand'>operand</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_ext'>ext</span> <span class='op'>=</span> <span class='id identifier rubyid_first_ancestor'>first_ancestor</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Extend.html" title="SPARQL::Algebra::Operator::Extend (class)">Extend</a></span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_extend_vars'>extend_vars</span> <span class='op'>=</span> <span class='id identifier rubyid_ext'>ext</span> <span class='op'>?</span> <span class='id identifier rubyid_ext'>ext</span><span class='period'>.</span><span class='id identifier rubyid_operand'>operand</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:first</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>RDF</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>Variable</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_project'>project</span> <span class='op'>=</span> <span class='id identifier rubyid_first_ancestor'>first_ancestor</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Project.html" title="SPARQL::Algebra::Operator::Project (class)">Project</a></span></span><span class='rparen'>)</span>
  <span class='comment'># If not projecting, were are effectively projecting all variables in the query
</span>  <span class='id identifier rubyid_project_vars'>project_vars</span> <span class='op'>=</span> <span class='id identifier rubyid_project'>project</span> <span class='op'>?</span> <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_operand'>operand</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_vars'>vars</span>

  <span class='id identifier rubyid_available_vars'>available_vars</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_extend_vars'>extend_vars</span> <span class='op'>+</span> <span class='id identifier rubyid_group_vars'>group_vars</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>

  <span class='comment'># All variables must either be grouped or extended
</span>  <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_project_vars'>project_vars</span> <span class='op'>-</span> <span class='id identifier rubyid_available_vars'>available_vars</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
         <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>projecting ungrouped/extended variables: </span><span class='embexpr_beg'>#{</span><span class='lparen'>(</span><span class='id identifier rubyid_project_vars'>project_vars</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span> <span class='op'>-</span> <span class='id identifier rubyid_available_vars'>available_vars</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sse'>to_sse</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>super</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="variables-instance_method">
  
    #<strong>variables</strong>  &#x21d2; <tt><span class='object_link'><a href="../../../Hash.html" title="Hash (class)">Hash</a></span>{Symbol =&gt; <span class='object_link'><a href="../../../RDF/Query/Variable.html" title="RDF::Query::Variable (class)">RDF::Query::Variable</a></span>}</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The variables used in the extension. Includes grouped variables and temporary, but not those in the query, itself</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../Hash.html" title="Hash (class)">Hash</a></span>{Symbol =&gt; <span class='object_link'><a href="../../../RDF/Query/Variable.html" title="RDF::Query::Variable (class)">RDF::Query::Variable</a></span>}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


170
171
172
173
174
175
176
177
178
179
180
181
182
183</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sparql/algebra/operator/group.rb', line 170</span>

<span class='kw'>def</span> <span class='id identifier rubyid_variables'>variables</span>
  <span class='id identifier rubyid_group_vars'>group_vars</span> <span class='op'>=</span> <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

  <span class='id identifier rubyid_aggregate_vars'>aggregate_vars</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>3</span> <span class='op'>?</span> <span class='id identifier rubyid_operand'>operand</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='comment'># Extract first element of each and merge it&#39;s variables
</span>  <span class='lparen'>(</span><span class='id identifier rubyid_group_vars'>group_vars</span> <span class='op'>+</span> <span class='id identifier rubyid_aggregate_vars'>aggregate_vars</span><span class='rparen'>)</span><span class='period'>.</span>
    <span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span>  <span class='op'>|</span><span class='id identifier rubyid_o'>o</span><span class='op'>|</span>
      <span class='id identifier rubyid_v'>v</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Array.html" title="Array (class)">Array</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_o'>o</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
      <span class='id identifier rubyid_v'>v</span> <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>RDF</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>Variable</span><span class='rparen'>)</span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span>
    <span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:variables</span><span class='rparen'>)</span><span class='period'>.</span>
    <span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_memo'>memo</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span><span class='op'>|</span> <span class='id identifier rubyid_memo'>memo</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_h'>h</span><span class='rparen'>)</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu May  5 21:57:04 2022 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-3.1.2).
</div>

    </div>
  </body>
</html>